<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Test</title>
    <style media="screen">
      html, body {
        width:100%;
        height:100%;
        padding: 0;
        margin: 0;
      }
      #select_canvas {
        display: none;
        z-index: 9999;
        position: absolute;
        left: 0px;
        top: 0px;
      }
    </style>
    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script>if (window.module) module = window.module;</script>
    <!-- <button id="start_select">Start selecting region</button> -->
    <canvas id="select_canvas"></canvas>
  </head>
  <body>
    <webview src="https://github.com/" style="width:100%;height:100%;" marginwidth=0 marginheight=0 frameborder=0></webview >
      <script type="text/javascript">
      var {ipcRenderer} = require('electron');
      ipcRenderer.on('capture', () => {
        var myCanvas = $('#select_canvas').get(0);
        var myCanvasContext = myCanvas.getContext('2d');
        myCanvasContext.clearRect(0, 0, myCanvas.width, myCanvas.height);
        document.body.style.cursor = "crosshair";
        $("#select_canvas").show();
      });
      window.addEventListener('resize', resizeCanvas, false);
      function resizeCanvas() {
          var myCanvas = $('#select_canvas').get(0);
          myCanvas.width = window.innerWidth;
          myCanvas.height = window.innerHeight;
      }
      resizeCanvas();
      $("#start_select").click(function() {
        var myCanvas = $('#select_canvas').get(0);
        var myCanvasContext = myCanvas.getContext('2d');
        myCanvasContext.clearRect(0, 0, myCanvas.width, myCanvas.height)
        $("#select_canvas").show();
      });

      var start = null;
      var ctx = $("#select_canvas").get(0).getContext('2d');
      $("#select_canvas").mousedown(function(e) {
        start = [e.offsetX, e.offsetY];
        ctx.globalAlpha = 0.5;
      }).mouseup(function(e) {
        end = [e.offsetX, e.offsetY];

        $(this).hide();
        setTimeout(() => {ipcRenderer.send('capture-done', start, end);start = null;}, 100);

      }).mousemove(function(e) {
        if(!start) return;

        ctx.clearRect(0, 0, this.offsetWidth, this.offsetHeight);
        ctx.beginPath();

        var x = e.offsetX,
            y = e.offsetY;

        ctx.rect(start[0], start[1], x - start[0], y - start[1]);
        ctx.fillStyle = "#b5b5b5";
        ctx.fill();
        ctx.lineWidth="4";
        ctx.strokeStyle="#6c6c6c";
        ctx.stroke();
      });
      </script>
  </body>
</html>
